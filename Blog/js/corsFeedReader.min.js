"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var CorsFeedReader=/*#__PURE__*/function(){function a(b,c,d){_classCallCheck(this,a),this.itemContainer=b,this.fetchOptions=c,this.setOptions(d),this.main()}return _createClass(a,[{key:"setOptions",value:function setOptions(a){var b={dev:!1,feedUrl:"",items:0,beforeTemplate:function beforeTemplate(){console.log("beforeTemplate not set")},afterTemplate:function afterTemplate(){console.log("afterTemplate not set")},template:"\n            <div class=\"feed-item {{ category }}\">\n              <a href=\"{{ link }}\">\n                  <h2>{{ title }}</h2>\n                </a>\n              <summary class=\"description\">\n                {{ pubDate }} <br>\n                {{ description }}\n              </summary>\n            "};for(var c in a)b[c]=a[c];this.options=b}},{key:"main",value:function main(){var a=this;fetch(this.options.feedUrl,this.fetchOptions).then(function(b){return a.handleResponse(b)})["catch"](function(a){return console.log(a)})}},{key:"handleResponse",value:function handleResponse(a){var b=a.headers.get("content-type");if(b.includes("application/rss+xml"))this.handleFeedResponse(a);else throw new Error("content-type:".concat(b," not supported"))}},{key:"handleFeedResponse",value:function handleFeedResponse(a){var b=this;a.text().then(function(c){return a.ok?void b.parseItems(c):Promise.reject({status:a.status,statusText:a.statusText,err:c})})}},{key:"parseItems",value:function parseItems(a){var b=new DOMParser,c=b.parseFromString(a,"text/xml"),d=c.querySelectorAll("item");if(0==this.options.items){this.options.items=d.length;var e=this.options.items}else{this.options.items--;var e=this.options.items+1}console.log("Processing ".concat(e," items out of ").concat(d.length," in the feed")),this.options.dev&&console.log(d);var f=this;d.forEach(function(a,b){if(b<e){var c={};a.childNodes.forEach(function(b){b=b.nodeName;try{b.startsWith("#")||(c[b]=a.querySelector(b))}catch(a){console.log(a.message)}}),f.template(c),f.options.dev&&console.log(c)}}),console.log("URL:",this.options.feedUrl," processed.")}},{key:"template",value:function(a){this.beforeTemplate(a);var b=this.options.template;for(var c in a){var d=new RegExp("{{ ".concat(c," }}"),"g");b="string"==typeof a[c]?b.replace(d,a[c]):b.replace(d,a[c].textContent)}this.templateOutput(b)}},{key:"templateOutput",value:function templateOutput(a){var b=document.querySelector(this.itemContainer);b.insertAdjacentHTML("beforeend",a),this.afterTemplate(content)}},{key:"beforeTemplate",value:function beforeTemplate(a){return this.options.beforeTemplate(a)}},{key:"afterTemplate",value:function afterTemplate(a){return this.options.afterTemplate(a)}}]),a}();
